function showInfo(e) { console.log("INFO: " + e), $(".message-info").html(e), $(".message-info").show(), setTimeout(function () { $(".message-info").hide() }, 4e3) } function showError(e) { console.log("ERROR: " + e), $(".message-error").html(e), $(".message-error").show(), setTimeout(function () { $(".message-error").hide() }, 4e3) } function prepareWifiMode() { "dhcp" == $("#ipMode").val() ? $(".staticIP").css("display", "none") : $(".staticIP").css("display", "") } function loadWIFI() { $.post("/api/loadwifi").done(function (e) { $("#wifi-name").val(e.wifi_ssid), $("#wifi-pass").val(e.wifi_password), $("#wifi-ipmode").val(e.wifi_mode), $("#wifi-ip").val(e.wifi_ip), $("#wifi-mask").val(e.wifi_mask), $("#wifi-gateway").val(e.wifi_gateway) }).fail(function (e) { showError("Error in load WIFI parameteres of WemosEM") }) } function loadCalibration() { $.post("/api/loadcalibrate").done(function (e) { $("#voltage").val(e.votalje), $("#ical").val(e.ical), $("#messageinterval").val(e.messageinterval) }).fail(function (e) { showError("Error in load Calibrate parameteres of WemosEM") }) } function loadtime() { $.post("/api/loadtime").done(function (e) { $("#timezone").val(e.timezone), $("#minute-timezone").val(e.minutestimezone) }).fail(function (e) { showError("Error in load Calibrate parameteres of WemosEM") }) } function loadSystem() { } function loadMQTT() { $.post("/api/loadmqtt").done(function (e) { $("#enableMQTT").prop("checked", e.mqtt_enabled), $("#mqtt-ip").val(e.mqtt_server), $("#mqtt-port").val(e.mqtt_port), $("#mqtt-user").val(e.mqtt_username), $("#mqtt-pass").val(e.mqtt_password) }).fail(function (e) { showError("Error in load MQTT parameteres of WemosEM") }) } function saveWifi() { $.post("/api/savewifi", { "wifi-name": $("#wifi-name").val(), "wifi-pass": $("#wifi-pass").val(), "wifi-ipmode": $("#wifi-ipmode").val(), "wifi-ip": $("#wifi-ip").val(), "wifi-mask": $("#wifi-mask").val(), "wifi-gateway": $("#wifi-gateway").val() }).done(function (e) { loadMQTT(), e && 0 != e.length ? showError("Error in Wifi saved parameters: " + JSON.stringify(e)) : (showInfo("Wifi parameters saved"), 1 == $("#wifi-ipmode").val() && (window.location.href = "http://" + $("#wifi-ip").val())) }).fail(function (e) { showError("Error in save Wifi parameteres of WemosEM") }) } function saveMQTT() { $.post("/api/savemqtt", { mqtt_enabled: $("#enableMQTT").prop("checked") ? "1" : "0", mqtt_server: $("#mqtt-ip").val(), mqtt_port: $("#mqtt-port").val(), mqtt_username: $("#mqtt-user").val(), mqtt_password: $("#mqtt-pass").val() }).done(function (e) { loadMQTT(), e && 0 != e.length ? showError("Error in MQTT saved parameters: " + JSON.stringify(e)) : showInfo("MQTT parameters saved") }).fail(function (e) { showError("Error in save MQTT parameteres of WemosEM") }) } function saveCalibrate() { $.post("/api/savecalibrate", { voltage: $("#voltage").val(), ical: $("#ical").val(), messageinterval: $("#messageinterval").val() }).done(function (e) { loadCalibration(), e && 0 != e.length ? showError("Error saving calibrate settings: " + JSON.stringify(e)) : showInfo("Calibrate settings saved") }).fail(function (e) { showError("Error saving Calibrate parameteres of WemosEM") }) } function saveTime() { $.post("/api/savetime", { timezone: $("#timezone").val(), minutestimezone: $("#minute-timezone").val() }).done(function (e) { loadCalibration(), e && 0 != e.length ? showError("Error saving time settings: " + JSON.stringify(e)) : showInfo("Timezone settings saved") }).fail(function (e) { showError("Error saving time settings of WemosEM") }) } function saveSystem() { $.post("/api/savesystem", { systempassword: $("#systemPassword").val() }).done(function (e) { loadSystem(), e && 0 != e.length ? showError("Error saving system settings: " + JSON.stringify(e)) : showInfo("System settings saved") }).fail(function (e) { showError("Error saving system settings of WemosEM") }) } function loadStatus() { setInterval(function () { $.post("/api/status").done(function (e) { $(".current-value").html(e.current), $(".voltage-value").html(e.voltage), $(".watios-value").html(e.watios), $(".kWh-value").html(e.kWh), $(".ical-value").html(e.ical), $(".mqttreconnected-value").html(e.mqttreconnected), $(".wifidb-value").html(e.wifidb), $(".uptime-value").html(e.uptime), $(".time-value").html(e.time), $(".freemem-value").html(e.freemem) }).fail(function (e) { console.log("Error in load status of WemosEM") }) }, 2e3) } !function (o) { o.each(["show", "hide"], function (e, t) { var i = o.fn[t]; o.fn[t] = function () { return this.trigger(t), i.apply(this, arguments) } }) }(jQuery), $(document).ready(function () { $(".see-system-password").mousedown(function () { $("#systemPassword").prop("type", "text") }), $(".see-system-password").mouseup(function () { $("#systemPassword").prop("type", "password") }), $(".see-mqtt-password").mousedown(function () { $("#mqtt-pass").prop("type", "text") }), $(".see-mqtt-password").mouseup(function () { $("#mqtt-pass").prop("type", "password") }), $(".btn-update").click(function () { window.location.href = "/WebFirmwareUpgrade" }); $.post("/api/id").done(function (e) { $(".wemos-id").html(e) }); loadStatus(), loadWIFI(), loadMQTT(), loadCalibration(), loadtime(), loadSystem(), $(".btn-reboot").click(function () { $.post("/reboot").done(function () { showInfo("reboot success") }).fail(function () { showError("error in reboot") }) }), $(".btn-reset").click(function () { $.post("/reset").done(function () { showInfo("reset success") }).fail(function () { showError("error in reset") }) }), $(".btn-save-wifi").click(function () { saveWifi() }), $(".btn-save-mqtt").click(function () { saveMQTT() }), $(".btn-save-calibrate").click(function () { saveCalibrate() }), $(".btn-save-time").click(function () { saveTime() }), $(".btn-save-system").click(function () { saveSystem() }), $("#ipMode").change(function () { prepareWifiMode() }), $(".cardWifi").on("show", function () { prepareWifiMode() }), $(".btn-wifi").click(function () { $(".card").hide(), $(".cardWifi").show() }), $(".btn-mqtt").click(function () { $(".card").hide(), $(".cardMQTT").show() }), $(".btn-calibrate").click(function () { $(".card").hide(), $(".cardCalibrate").show() }), $(".btn-time").click(function () { $(".card").hide(), $(".cardTime").show() }), $(".btn-system").click(function () { $(".card").hide(), $(".cardSystem").show() }) });